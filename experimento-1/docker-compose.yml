version: '3'
services:
  # Espacio para tu apigateway
  nginx:
    image: nginx:latest
    ports:
      - 5000:8080
    volumes:
        - ./api-gateway/nginx-proxy.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
        - monitor
        - registro_usuario
        - consulta_usuario
    networks:
      network:

  # Servidor principal con codigo de servicio de registro de usuarios
  registro_usuario:
    build:
      context: ./registro_usuario
    networks:
      network:

  consulta_usuario:
    build:
      context: ./consulta_usuario
    networks:
      network:

  db_usuario:
    build:
      context: ./db_usuario
    networks:
      network:

  monitor:
    build:
      context: ./monitor
    environment:
      # Este es el nombre del servidor principal
      - SERVER_X_NAME=registro_usuario-1
      # Esta imagen te la debe proporcionar Emerson, es la imagen del servidor 
      # del codigo fuente (servicio de registro de usuario)
      - SERVER_X_IMAGE=fc2131b4d05334a5d061ad3f4ef0024bdd351a0a7676bf4d2d8bff87c89ae2f0
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock  
    networks:
      network:

networks:
  network:
